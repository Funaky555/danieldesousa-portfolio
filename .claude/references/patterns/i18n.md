# Internationalization (i18n) Patterns

## Overview

Implement multi-language support in Next.js 15 with next-intl.

## Setup

### Install
```bash
npm install next-intl
```

### Project Structure
```
├── messages/
│   ├── en.json
│   ├── es.json
│   └── pt.json
├── src/
│   ├── i18n/
│   │   ├── config.ts
│   │   └── request.ts
│   └── app/
│       └── [locale]/
│           ├── layout.tsx
│           └── page.tsx
└── middleware.ts
```

## Configuration

### i18n/config.ts
```typescript
export const locales = ["en", "es", "pt"] as const;
export type Locale = (typeof locales)[number];

export const defaultLocale: Locale = "en";

export const localeNames: Record<Locale, string> = {
  en: "English",
  es: "Español",
  pt: "Português",
};
```

### i18n/request.ts
```typescript
import { getRequestConfig } from "next-intl/server";
import { locales, type Locale } from "./config";

export default getRequestConfig(async ({ locale }) => {
  // Validate locale
  if (!locales.includes(locale as Locale)) {
    throw new Error(`Invalid locale: ${locale}`);
  }

  return {
    messages: (await import(`../../messages/${locale}.json`)).default,
  };
});
```

### middleware.ts
```typescript
import createMiddleware from "next-intl/middleware";
import { locales, defaultLocale } from "./i18n/config";

export default createMiddleware({
  locales,
  defaultLocale,
  localePrefix: "as-needed", // or "always" or "never"
});

export const config = {
  matcher: ["/((?!api|_next|.*\\..*).*)"],
};
```

### next.config.js
```javascript
const withNextIntl = require("next-intl/plugin")("./src/i18n/request.ts");

module.exports = withNextIntl({
  // Other Next.js config
});
```

## Translation Files

### messages/en.json
```json
{
  "common": {
    "loading": "Loading...",
    "error": "An error occurred",
    "save": "Save",
    "cancel": "Cancel"
  },
  "home": {
    "title": "Welcome",
    "description": "This is the home page"
  },
  "auth": {
    "login": "Log in",
    "logout": "Log out",
    "email": "Email address",
    "password": "Password"
  }
}
```

### messages/es.json
```json
{
  "common": {
    "loading": "Cargando...",
    "error": "Ocurrió un error",
    "save": "Guardar",
    "cancel": "Cancelar"
  },
  "home": {
    "title": "Bienvenido",
    "description": "Esta es la página de inicio"
  },
  "auth": {
    "login": "Iniciar sesión",
    "logout": "Cerrar sesión",
    "email": "Correo electrónico",
    "password": "Contraseña"
  }
}
```

## Layout Setup

### app/[locale]/layout.tsx
```typescript
import { NextIntlClientProvider } from "next-intl";
import { getMessages, getTranslations } from "next-intl/server";
import { locales, type Locale } from "@/i18n/config";

export function generateStaticParams() {
  return locales.map((locale) => ({ locale }));
}

export async function generateMetadata({
  params: { locale },
}: {
  params: { locale: Locale };
}) {
  const t = await getTranslations({ locale, namespace: "home" });

  return {
    title: t("title"),
  };
}

export default async function LocaleLayout({
  children,
  params: { locale },
}: {
  children: React.ReactNode;
  params: { locale: Locale };
}) {
  const messages = await getMessages();

  return (
    <html lang={locale}>
      <body>
        <NextIntlClientProvider messages={messages}>
          {children}
        </NextIntlClientProvider>
      </body>
    </html>
  );
}
```

## Using Translations

### Server Components
```typescript
import { getTranslations } from "next-intl/server";

export default async function HomePage() {
  const t = await getTranslations("home");

  return (
    <div>
      <h1>{t("title")}</h1>
      <p>{t("description")}</p>
    </div>
  );
}
```

### Client Components
```typescript
"use client";

import { useTranslations } from "next-intl";

export function LoginForm() {
  const t = useTranslations("auth");

  return (
    <form>
      <label>{t("email")}</label>
      <input type="email" />

      <label>{t("password")}</label>
      <input type="password" />

      <button type="submit">{t("login")}</button>
    </form>
  );
}
```

## Advanced Features

### Interpolation
```json
{
  "greeting": "Hello, {name}!",
  "items": "You have {count, plural, =0 {no items} one {# item} other {# items}}"
}
```

```typescript
const t = useTranslations();
t("greeting", { name: "John" });        // "Hello, John!"
t("items", { count: 0 });               // "You have no items"
t("items", { count: 1 });               // "You have 1 item"
t("items", { count: 5 });               // "You have 5 items"
```

### Rich Text
```json
{
  "terms": "By signing up, you agree to our <link>terms of service</link>."
}
```

```typescript
t.rich("terms", {
  link: (chunks) => <Link href="/terms">{chunks}</Link>,
});
```

### Date & Number Formatting
```typescript
import { useFormatter } from "next-intl";

function PriceDisplay({ amount, date }) {
  const format = useFormatter();

  return (
    <div>
      <p>{format.number(amount, { style: "currency", currency: "USD" })}</p>
      <p>{format.dateTime(date, { dateStyle: "full" })}</p>
      <p>{format.relativeTime(date)}</p>
    </div>
  );
}
```

## Language Switcher

```typescript
"use client";

import { useLocale } from "next-intl";
import { useRouter, usePathname } from "next/navigation";
import { locales, localeNames, type Locale } from "@/i18n/config";

export function LanguageSwitcher() {
  const locale = useLocale();
  const router = useRouter();
  const pathname = usePathname();

  function switchLocale(newLocale: Locale) {
    // Remove current locale from pathname
    const pathWithoutLocale = pathname.replace(`/${locale}`, "") || "/";
    router.push(`/${newLocale}${pathWithoutLocale}`);
  }

  return (
    <select
      value={locale}
      onChange={(e) => switchLocale(e.target.value as Locale)}
    >
      {locales.map((loc) => (
        <option key={loc} value={loc}>
          {localeNames[loc]}
        </option>
      ))}
    </select>
  );
}
```

## Best Practices

1. **Use namespaces** - Organize translations by feature/page
2. **Keep keys descriptive** - `auth.login.button` not `btn1`
3. **Extract to constants** - Avoid inline translation keys
4. **Handle missing translations** - Set up fallbacks
5. **Use ICU syntax** - For plurals, dates, numbers
6. **Test all locales** - Especially RTL languages

## Type Safety

### Generate Types
```typescript
// global.d.ts
type Messages = typeof import("./messages/en.json");

declare global {
  interface IntlMessages extends Messages {}
}
```

This enables autocomplete for translation keys.
